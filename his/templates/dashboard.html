{% extends 'base.html' %}
{% load static %}

{% block title %}Dashboard | Hospital HIS{% endblock %}

{% block content %}
<div class="dashboard-container">
    <div class="dashboard-header">
        <h1>Welcome, {{ user.get_full_name }}!</h1>
        <p class="user-role">{{ user.role|capfirst }} Dashboard</p>
        <div class="quick-stats">
            <div class="stat-card">
                <h3>{{ total_patients }}</h3>
                <p>Total Patients</p>
            </div>
            <div class="stat-card">
                <h3>{{ active_visits }}</h3>
                <p>Active Visits</p>
            </div>
            <div class="stat-card">
                <h3>{{ today_appointments }}</h3>
                <p>Today's Appointments</p>
            </div>
            {% if user.role == 'finance' %}
            <div class="stat-card">
                <h3>₹{{ today_revenue|floatformat:0 }}</h3>
                <p>Today's Revenue</p>
            </div>
            {% endif %}
        </div>
    </div>

    <div class="dashboard-content">

        {% if user.role == 'admin' %}
        <!-- Admin Dashboard -->
        <div class="admin-section">
            <div class="module-grid">
                <div class="module-card">
                    <h3><i class="fas fa-users-cog"></i> User Management</h3>
                    <p>Manage staff, roles, and permissions</p>
                    <div class="quick-actions">
                        <a href="{% url 'users-list' %}" class="btn btn-primary">Manage Users</a>
                        <a href="{% url 'system-config' %}" class="btn btn-secondary">System Config</a>
                    </div>
                    <div class="module-stats">
                        <span>Active Staff: {{ total_staff }}</span>
                        <span>Pending Leaves: {{ pending_leave_requests }}</span>
                    </div>
                </div>
                
                <div class="module-card">
                    <h3><i class="fas fa-chart-line"></i> Analytics</h3>
                    <p>View comprehensive reports and analytics</p>
                    <div class="quick-actions">
                        <a href="{% url 'analytics-dashboard' %}" class="btn btn-primary">View Analytics</a>
                        <a href="{% url 'audit-logs' %}" class="btn btn-secondary">Audit Logs</a>
                    </div>
                </div>

                <div class="module-card">
                    <h3><i class="fas fa-exclamation-triangle"></i> Alerts</h3>
                    <p>System alerts and notifications</p>
                    <div class="alert-item expired">
                        <i class="fas fa-calendar-times"></i>
                        <span>Expired Items</span>
                        <span class="count">3</span>
                    </div>
                </div>
                <a href="{% url 'pharmacy-dashboard' %}" class="btn btn-primary">Manage Stock</a>
            </div>

            <div class="pending-prescriptions">
                <h3>Pending Dispensing</h3>
                <div class="prescription-queue">
                    <div class="queue-item">
                        <span class="patient">P001 - John Doe</span>
                        <span class="time">10:30 AM</span>
                        <button class="btn btn-sm btn-success">Dispense</button>
                    </div>
                </div>
            </div>
        </div>

        {% elif user.role == 'doctor' %}
        <!-- Doctor Dashboard -->
        <div class="doctor-section">
            <div class="today-schedule">
                <h3>Today's Schedule</h3>
                <div class="appointment-summary">
                    <div class="time-slot">
                        <span class="time">09:00 - 12:00</span>
                        <span class="count">{{ my_appointments_today }} appointments</span>
                    </div>
                </div>
                <a href="{% url 'appointments-list' %}" class="btn btn-primary">View All Appointments</a>
            </div>

            <div class="patient-queue">
                <h3>My Patients</h3>
                <p>{{ my_patients }} active patients under your care</p>
                <div class="quick-actions">
                    <a href="{% url 'patients-list' %}" class="btn btn-primary">View Patients</a>
                    <a href="{% url 'op-registration' %}" class="btn btn-success">New OPD</a>
                </div>
            </div>

            <div class="quick-orders">
                <h3>Quick Orders</h3>
                <div class="order-buttons">
                    <button class="btn btn-info" onclick="openLabOrder()">Lab Order</button>
                    <button class="btn btn-info" onclick="openRadiologyOrder()">Radiology</button>
                    <button class="btn btn-info" onclick="openPrescription()">Prescription</button>
                </div>
            </div>
        </div>

        {% elif user.role == 'nurse' %}
        <!-- Nurse Dashboard -->
        <div class="nurse-section">
            <div class="ward-overview">
                <h3>Ward Management</h3>
                <div class="ward-stats">
                    <div class="stat-item">
                        <span class="number">{{ patients_in_ward }}</span>
                        <span class="label">Patients in Ward</span>
                    </div>
                    <div class="stat-item">
                        <span class="number">{{ vitals_pending }}</span>
                        <span class="label">Vitals Pending</span>
                    </div>
                </div>
                <a href="{% url 'ward-management' %}" class="btn btn-primary">Manage Wards</a>
            </div>

            <div class="nursing-tasks">
                <h3>Today's Tasks</h3>
                <div class="task-list">
                    <div class="task-item">
                        <input type="checkbox"> Morning vitals rounds
                    </div>
                    <div class="task-item">
                        <input type="checkbox"> Medication administration
                    </div>
                    <div class="task-item">
                        <input type="checkbox"> Patient monitoring
                    </div>
                </div>
            </div>

            <div class="emergency-actions">
                <h3>Emergency</h3>
                <button class="btn btn-danger btn-large" onclick="emergencyAdmit()">
                    <i class="fas fa-ambulance"></i> Emergency Admit
                </button>
            </div>
        </div>

        {% elif user.role == 'pharmacist' %}
        <!-- Pharmacist Dashboard -->
        <div class="pharmacy-section">
            <div class="stock-overview">
                <h3>Stock Status</h3>
                <div class="stock-alerts">
                    <div class="alert-item low-stock">
                        <i class="fas fa-exclamation-triangle"></i>
                        <span>Low Stock Items</span>
                        <span class="count">{{ low_stock_items }}</span>
                    </div>
                    <div class="alert-item expired">
                        <i class="fas fa-times-circle"></i>
                        <span>Expired Items</span>
                        <span class="count">{{ expired_items }}</span>
                    </div>
                </div>
                <a href="{% url 'pharmacy-stock' %}" class="btn btn-primary">Manage Stock</a>
            </div>

            <div class="dispensing-actions">
                <h3>Dispensing</h3>
                <p>Quick access to dispensing queue and pending orders</p>
                <div class="quick-actions">
                    <a href="{% url 'dispense-queue' %}" class="btn btn-success">View Dispensing Queue</a>
                    <a href="{% url 'purchase-orders' %}" class="btn btn-info">Purchase Orders</a>
                </div>
            </div>
        </div>

        {% elif user.role == 'lab' %}
        <!-- Lab Technician Dashboard -->
        <div class="lab-section">
            <div class="sample-status">
                <h3>Sample Processing</h3>
                <div class="process-stats">
                    <div class="stat-box pending">
                        <span class="number">{{ pending_samples }}</span>
                        <span class="label">Pending Collection</span>
                    </div>
                    <div class="stat-box processing">
                        <span class="number">{{ processing_samples }}</span>
                        <span class="label">In Progress</span>
                    </div>
                    <div class="stat-box completed">
                        <span class="number">{{ completed_today }}</span>
                        <span class="label">Completed Today</span>
                    </div>
                </div>
                <a href="{% url 'lab-dashboard' %}" class="btn btn-primary">Lab Management</a>
            </div>
        </div>

        {% elif user.role == 'finance' %}
        <!-- Finance Dashboard -->
        <div class="finance-section">
            <div class="revenue-overview">
                <h3>Financial Overview</h3>
                <div class="finance-stats">
                    <div class="revenue-card">
                        <h4>₹{{ today_revenue|floatformat:0 }}</h4>
                        <p>Today's Revenue</p>
                    </div>
                    <div class="pending-card">
                        <h4>{{ pending_invoices }}</h4>
                        <p>Pending Invoices</p>
                    </div>
                </div>
                <a href="{% url 'finance-dashboard' %}" class="btn btn-primary">Finance Management</a>
            </div>

            <div class="billing-actions">
                <h3>Quick Actions</h3>
                <div class="action-buttons">
                    <a href="{% url 'invoice-create' %}" class="btn btn-success">Create Invoice</a>
                    <button class="btn btn-info" onclick="recordPayment()">Record Payment</button>
                </div>
            </div>
        </div>

        {% elif user.role == 'patient' %}
        <!-- Patient Dashboard -->
        <div class="patient-section">
            <div class="my-appointments">
                <h3>My Appointments</h3>
                <div class="appointment-list">
                    <!-- Appointments will be loaded here -->
                </div>
                <a href="{% url 'appointments-list' %}" class="btn btn-primary">View All</a>
            </div>

            <div class="medical-records">
                <h3>Medical Records</h3>
                <p>Access your medical history and reports</p>
                <a href="#" class="btn btn-info">View Records</a>
            </div>

            <div class="billing-info">
                <h3>Billing</h3>
                <p>View and pay your medical bills</p>
                <a href="{% url 'pay_bills' %}" class="btn btn-warning">Pay Bills</a>
            </div>
        </div>

        {% endif %}

        <!-- Common Notifications Panel -->
        <div class="notifications-panel">
            <h3>Recent Notifications</h3>
            <div id="notifications-container">
                <!-- Notifications loaded via AJAX -->
            </div>
        </div>
    </div>
</div>

<!-- OP Registration Button (Common Access) -->
<div class="container mt-4">
    <a href="{% url 'op-registration' %}" class="btn btn-primary mt-3">
        Go to OP Registration
    </a>
</div>

<!-- Include your existing CSS and JS here (same as before) -->
{% endblock %}
